<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>天气数据可视化</title>
<script src="lib/jquery-3.2.0.min.js"></script>
<script src="lib/city.list.json"></script>
    <!-- Load c3.css -->
<link href="lib/c3-0.4.11/c3-0.4.11/c3.css" rel="stylesheet" type="text/css">
<!-- Load d3.js and c3.js -->
<script src="lib/d3/d3.min.js" charset="utf-8"></script>
<script src="lib/c3-0.4.11/c3-0.4.11/c3.min.js"></script>
<style>
#nav{
  height:80px;
  width: 100%;
  background: orange;
  color:white;
  position: fixed;
  top:0;
  left:0;
  z-index: 1;
}
#chart{
  margin-top:80px;
  background: #fff2e3;
}
</style>
</head>
<body>
<div id="nav">  
<button id="b01" type="button">输入城市名字</button><input id="ipt" placeholder="这里输入城市拼音/英文"></input></button>
<button id="b02" type="button">清空</button><button id="b03" type="button">步状图</button><button id="b04" type="button">曲线图</button>
</div>
<div id="chart"></div>
</body>
<script>
  var allTemperatureArray=[];
  $("#b01").click(function(){
    //让首字母大写
    var txt = document.getElementById("ipt").value.toString().toLowerCase().split("");
    txt[0]=txt[0].toUpperCase();
    txt=txt.join("");
    //翻本地json
         for(var i=0;i<cityList.length;i++){
           if(cityList[i].name===txt){
             var cityCode=cityList[i]._id;
    //ajax拿数据
    $.ajax({
         url:"//api.openweathermap.org/data/2.5/forecast?id="+cityCode+"&APPID=32785e8acc22078c162ee8aedd2307e1",
         dataType:"json",
         cache:"false",
         type:"GET",
         success:function(res){
         //  $("#myDiv").html(JSON.stringify(res));
         //填充数组
         var cityCodeString=String(cityCode);
         window['arr'+cityCode]=[];
         window['arr'+cityCode].push(txt);
           for(var j=0;j<res.list.length;j++){
           window['arr'+cityCode].push((Math.floor(res.list[j].main.temp-273.15)*10)/10);//把开氏度换算成摄氏度
           }//for-j
             //绘成图形
             chart.load({
             columns: [
             window['arr'+cityCode]
             ]
             });//chart.load
         allTemperatureArray.push(window['arr'+cityCode]);//放进去，改变显示风格时需要遍历出来
         console.log(window['arr'+cityCode])
         console.log(allTemperatureArray)
         }//success
     });//ajax            
    };//if
   };//for-i
  })//click

  //清空
    $("#b02").click(function(){
      chart.unload();
    })
   //步状图
    $("#b03").click(function(){
      console.log(allTemperatureArray)
      for(var i=0;i<allTemperatureArray.length;i++){
        var haha=allTemperatureArray[i].slice(1,allTemperatureArray.length-1);
        chart.load({
        columns: [
            haha
        ],
        type: 'area-step'
      })
      }
    })//b03
    //曲线图
    $("#b04").click(function(){
      console.log(allTemperatureArray)
      for(var i=0;i<allTemperatureArray.length;i++){
        var haha=allTemperatureArray[i].slice(1,allTemperatureArray.length-1);
        chart.load({
        columns: [
            haha
        ],
        type: 'spline'
      })
      }
    })//b03
//初始可视化
var chart = c3.generate({
    bindto: '#chart',
    data: {
      columns: [],
      types: 'spline'
    }
});
</script>
</html>