<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>天气数据可视化</title>
<script src="lib/jquery-3.2.0.min.js"></script>
<script src="lib/city.list.json"></script>
    <!-- Load c3.css -->
<link href="lib/c3-0.4.11/c3-0.4.11/c3.css" rel="stylesheet" type="text/css">
<!-- Load d3.js and c3.js -->
<script src="lib/d3/d3.min.js" charset="utf-8"></script>
<script src="lib/c3-0.4.11/c3-0.4.11/c3.min.js"></script>
<style>
#nav{
  height:80px;
  width: 100%;
  background: orange;
  color:white;
  position: fixed;
  top:0;
  left:0;
  z-index: 1;
}
#chart{
  margin-top:80px;
  background: #fff2e3;
}
</style>
</head>
<body>
<div id="nav">  
<button id="b01" type="button">输入城市名字</button><input id="ipt" placeholder="这里输入城市拼音/英文"></input></button>
<button id="b02" type="button">清空</button><button id="b03" type="button">面积步状图</button><button id="b04" type="button">曲线图</button>
<button id="b05" type="button">点状图</button><button id="b06" type="button">柱状图</button><button id="b07" type="button">面积曲线图</button>
<button id="b08" type="button">测试按钮1</button><button id="b00" type="button">测试按钮2</button>
</div>
<div id="chart"></div>
</body>
<script>
//试验田
  var axis_x_localtime;
      var data1 = {
          x : 'date',
          columns: [
            ['date', '2013-01-01', '2013-01-02', '2013-01-03', '2013-01-04', '2013-01-05'],
            ['sample', 30, 200, 100, 400, 150],
            ['sample2', 130, 300, 200, 450, 250]
          ]
      };

    $("#b00").click(function(){
        return c3.generate({
        bindto: '#chart',
        columns:columns,
        axis: {  
         y: {
         label: {
          text: '测试度',
          position: 'outer-middle'
          },
        }
      }//axis

      }); 
    })
   

  //初始可视化
    var chart = c3.generate({
    bindto: '#chart',
    data: {
      columns: [],
      type: 'spline'//坑爹啊！！这里不能写成types，搞了我3个小时
    },
     axis: {
      y: {
        label: {
          text: '摄氏度',
          position: 'outer-middle'
        },
      }
    }//axis
  });
  var cityCodes=[];//城市号码集
  //拿杭州数据
  var cityCode=1808926;
      $.ajax({
         url:"//api.openweathermap.org/data/2.5/forecast?id=1808926&APPID=32785e8acc22078c162ee8aedd2307e1",
         dataType:"json",
         cache:"false",
         type:"GET",
         success:function(res){
         //填充数组
         window['arr'+cityCode]=[];
         window['arr'+cityCode].push('Hangzhou');
           for(var j=0;j<res.list.length;j++){
           window['arr'+cityCode].push((Math.floor(res.list[j].main.temp-273.15)*10)/10);//把开氏度换算成摄氏度
           }//for-j
            //  //绘成图形
             chart.load({
             columns: [
             window['arr'+cityCode]
             ],
             type: 'spline'
             });//chart.load
         cityCodes.push(cityCode);//储存城市号码
         }//success
     });//ajax 
// });//ready


  $("#b01").click(function(){
    //让首字母大写
    var txt = document.getElementById("ipt").value.toString().toLowerCase().split("");
    txt[0]=txt[0].toUpperCase();
    txt=txt.join("");
    //翻本地json
         for(var i=0;i<cityList.length;i++){
           if(cityList[i].name===txt){
             var cityCode=cityList[i]._id;
    //ajax拿数据
    $.ajax({
         url:"//api.openweathermap.org/data/2.5/forecast?id="+cityCode+"&APPID=32785e8acc22078c162ee8aedd2307e1",
         dataType:"json",
         cache:"false",
         type:"GET",
         success:function(res){
         //  $("#myDiv").html(JSON.stringify(res));
         //填充数组
         //  var cityCodeString=String(cityCode);
         window['arr'+cityCode]=[];
         window['arr'+cityCode].push(txt);
           for(var j=0;j<res.list.length;j++){
           window['arr'+cityCode].push((Math.floor(res.list[j].main.temp-273.15)*10)/10);//把开氏度换算成摄氏度
           }//for-j
             //绘成图形
             chart.load({
             columns: [
             window['arr'+cityCode]
             ],
             type: 'spline'
             });//chart.load
         cityCodes.push(cityCode);//储存城市号码
         }//success
     });//ajax            
    };//if
   };//for-i
  })//click

  //清空
    $("#b02").click(function(){
      chart.unload();
      cityCodes=[];
    })
   //面积步状图
    $("#b03").click(function(){
      for(var i=0;i<cityCodes.length;i++){
        chart.load({
        columns: [
            window['arr'+cityCodes[i]]
        ],
        type: 'area-step'
      })
      }
    })//b03
            
    //曲线图
    $("#b04").click(function(){
      for(var i=0;i<cityCodes.length;i++){
        chart.load({
        columns: [
            window['arr'+cityCodes[i]]
        ],
        type: 'spline'
      })
      }
    })//b04

    //点状图
    $("#b05").click(function(){
      for(var i=0;i<cityCodes.length;i++){
        chart.load({
        columns: [
            window['arr'+cityCodes[i]]
        ],
        type: 'scatter'
      })
      }
    })//b05

        //柱状图
    $("#b06").click(function(){
      for(var i=0;i<cityCodes.length;i++){
        chart.load({
        columns: [
            window['arr'+cityCodes[i]]
        ],
        type: 'bar'
      })
      }
    })//b06

    //面积曲线图
    $("#b07").click(function(){
      for(var i=0;i<cityCodes.length;i++){
        chart.load({
        columns: [
            window['arr'+cityCodes[i]]
        ],
        type: 'area-spline'
      })
      }
    })//b07

    //测试按钮
    $("#b08").click(function(){
    // chart.axis.labels({y: '摄氏度'});//有效
    // chart.axis.labels({position: 'outer-middle'});//无效
    chart = c3.generate({
          data: {
            columns: columns,
          },
          legend: {
            show: false
          }
        });
})
  

</script>
</html>